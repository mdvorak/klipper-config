[gcode_macro RESUME_M600]
gcode:
  {% set E = params.E|default(0)|float %}

  # extrude a bit to counter retract after load
  M83
  {% if E > 0 %}
    G1 E{E} F300
  {% endif %}

  # restore state from M600
  RESTORE_GCODE_STATE NAME=filament_change MOVE=1 MOVE_SPEED=10000

  # resume
  RESUME
