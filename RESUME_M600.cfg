[gcode_macro RESUME_M600]
gcode:
  # move back to z
  {% set origin_z = printer["gcode_macro m600"].z %}
  G90
  G1 Z{origin_z + 10} F6000

  # clear the nozzle
  M83
  G1 E4 F100
  G1 E-4 F400
  G1 E4 F400

  # restore state from M600
  RESTORE_GCODE_STATE NAME=filament_change

  # resume
  RESUME
