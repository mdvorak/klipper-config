[kmms]

[kmms_filament_switch_sensor hub]
switch_pin: ^!mmu:PB9

[kmms_encoder hub]
encoder_pin: ^mmu:PA5
encoder_resolution: 1.0
desired_headroom: 5.0
average_samples: 4			# The "damping" effect of last measurement. Higher value means clog_length will be reduced more slowly
flowrate_samples: 20			# How many "movements" on the encoder to measure over for flowrate calc
detection_mode: 0

[kmms_back_pressure_sensor hub]
adc: !PA6
min: 0.2
target: 0.4

[kmms_filament_switch_sensor toolhead]
switch_pin: ^toolhead:LIMIT_1

[kmms_filament_switch_sensor extruder]
switch_pin: ^toolhead:LIMIT_2

[tmc2209 kmms_extruder hub]
uart_pin: mmu:MMU_GEAR_UART
uart_address: 0 			# Comment out for ERB board
run_current: 0.5			# ERCF BOM NEMA14 motor
interpolate: True
sense_resistor: 0.110			# Usually 0.11, 0.15 for BTT TMC2226
stealthchop_threshold: 0		# Spreadcycle has more torque and better at speed

[kmms_extruder hub]
step_pin: mmu:MMU_GEAR_STEP
dir_pin: !mmu:MMU_GEAR_DIR
enable_pin: !mmu:MMU_GEAR_ENABLE
rotation_distance: 22.7316868		# Bondtech 5mm Drive Gears. Will be overriden by `mmu_gear_rotation_distance` in mmu_vars.cfg
gear_ratio: 80:17 # BMG extruder
microsteps: 16 				# Recommend 16
full_steps_per_rotation: 200		# 200 for 1.8 degree, 400 for 0.9 degree
max_velocity: 200
max_accel: 500

[gcode_macro KMMS_MOVE_NEXT]
gcode:
  _KMMS_MOVE_NEXT
