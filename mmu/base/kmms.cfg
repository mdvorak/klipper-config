[mcu mmu]
serial: /dev/serial/by-id/usb-Klipper_samd21g18a_418D707B3359535120202036212907FF-if00

[kmms]
max_velocity: 200
max_accel: 1500

[kmms_path spool_0]
path:
  kmms_extruder hub
  kmms_filament_switch_sensor hub
  kmms_backpressure_sensor hub
  kmms_filament_switch_sensor toolhead
  extruder
  kmms_filament_switch_sensor extruder

[kmms_filament_switch_sensor hub]
switch_pin: ^!mmu:PB9

[kmms_encoder hub]
encoder_pin: ^mmu:PA5
encoder_resolution: 1.0
desired_headroom: 5.0
average_samples: 4			# The "damping" effect of last measurement. Higher value means clog_length will be reduced more slowly
flowrate_samples: 20			# How many "movements" on the encoder to measure over for flowrate calc
detection_mode: 0

[kmms_backpressure_sensor hub]
adc: !mmu:PA6
min: 0.2
target: 0.4
report_as_temperature: true

[kmms_filament_switch_sensor toolhead]
switch_pin: ^toolhead:LIMIT_2

[kmms_filament_switch_sensor extruder]
switch_pin: ^toolhead:LIMIT_1

[tmc2209 kmms_extruder hub]
uart_pin: mmu:PA8
uart_address: 0 			# Comment out for ERB board
run_current: 0.5			# ERCF BOM NEMA14 motor
interpolate: True
sense_resistor: 0.110			# Usually 0.11, 0.15 for BTT TMC2226
stealthchop_threshold: 0		# Spreadcycle has more torque and better at speed

[kmms_extruder hub]
step_pin: mmu:PA9
dir_pin: !mmu:PB8
enable_pin: !mmu:PA11
rotation_distance: 22.7316868		# Bondtech 5mm Drive Gears. Will be overriden by `mmu_gear_rotation_distance` in mmu_vars.cfg
gear_ratio: 80:17 # BMG extruder
microsteps: 16 				# Recommend 16
full_steps_per_rotation: 200		# 200 for 1.8 degree, 400 for 0.9 degree

[gcode_macro KMMS__PRELOAD]
gcode: KMMS_PRELOAD

[gcode_macro KMMS__ACTIVATE_EXTRUDER]
gcode: KMMS_ACTIVATE_EXTRUDER
