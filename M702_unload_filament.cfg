# unload filament
[gcode_macro M702]
gcode:
    SAVE_GCODE_STATE NAME=unloading_filament
    LOW_TEMP_CHECK WAIT=0
    M125 # park
    M117 Unloading Filament
    G91
    G1 Z20 F1000 # Move up
    LOW_TEMP_CHECK
    M83
    G92 E0.0
    G1 E15 F200
    G4 P5000 # wait 5s
    G1 E18 F200
    G1 E-100 F1000
    G1 E-10 F600
    G92 E0.0
    G1 Z-20 F1000 # Move back down
    RESTORE_GCODE_STATE NAME=unloading_filament
