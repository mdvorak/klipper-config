# load filament
[gcode_macro M701]
gcode:
    {% set R = params.R|default(0)|float %}

    SAVE_GCODE_STATE NAME=loading_filament
    M117 Loading Filament
    M118 Loading Filament
    LOW_TEMP_CHECK WAIT=0
    M125 # park
    G91
    G1 Z20 F1000 # Move up
    LOW_TEMP_CHECK
    G92 E0.0
    G1 E95 F600
    G1 E60 F200  # some extra to prime the nozzle --> slower
    {% if R > 0 %}
    G1 E-{R} F600 ; retract
    {% endif %}
    G92 E0.0
    G1 Z-20 F1000 # Move back down
    RESTORE_GCODE_STATE NAME=loading_filament
