[gcode_macro PRINT_START]
gcode:
  {% set EXTRUDER = params.EXTRUDER|int %}
  {% set BED = params.BED|int %}
  {% set th = printer.toolhead %}

  STATUS_HEATING
  M190 S{BED} ; wait for bed temp to stabilize
  M109 S{EXTRUDER} ; wait for extruder temp to stabilize

  G32                            ; home all axes
  WIPE_NOZZLE
  G28

  STATUS_PRINTING

[gcode_macro WIPE_NOZZLE]
gcode:
  PARK
  G90
  G0 X{th.axis_maximum.x - 5} Y252 Z0.12 F10000

  G91
  G0 E10 F360    ; extract a bit
  G0 E5 F3600    ; blob a bit
  G0 E-22 F3600  ; forming filament Tip
  G0 E2 F300
  G0 E-2.1 F300
  G0 E2 F300
  G0 E-2.2 F300
  G0 E2 F300
  G0 E-2.3 F300
  G0 E2 F300
  G0 E-2.4 F300
  G0 E2 F300
  G0 E-2.5 F300
  G0 E2 F300
  G0 E-4 F300

  G90
  G1 Y240 F10000
  G1 X{th.axis_maximum.x - 5} Y252 Z20 F10000

  G0 X{th.axis_maximum.x - 5} Y252 Z0.12 F10000
  G1 Y240 F10000

  PARK
